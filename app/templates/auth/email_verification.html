{% extends "base.html" %}

{% block title %}Подтверждение email{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8 col-12">
            <!-- Основная карточка -->
            <div class="card border-0 text-center" style="background: #1a1a1a; border: 1px solid #3a3a3a;">
                <div class="card-body p-4">
                    <!-- Иконка -->
                    <div class="mb-4">
                        <i class="fas fa-envelope fa-3x text-muted"></i>
                    </div>

                    <!-- Заголовок -->
                    <div class="mb-4">
                        <h2 class="fw-bold text-white mb-2">Проверьте вашу почту</h2>
                        <p class="text-muted">Введите код, отправленный на</p>
                        <p class="text-white fw-bold">{{ user_email }}</p>
                    </div>

                    <!-- Форма ввода кода -->
                    <form method="POST">
                        {{ form.hidden_tag() }}
                        
                        <!-- Единое поле для ввода кода -->
                        <div class="mb-4">
                            <input type="text" 
                                   id="verification-code"
                                   name="verification_code" 
                                   maxlength="6" 
                                   class="form-control text-center fw-bold"
                                   style="width: 200px; height: 60px; font-size: 1.5rem; border-radius: 12px; margin: 0 auto; letter-spacing: 8px;"
                                   placeholder="000000"
                                   oninput="updateFormCode();"
                                   autocomplete="off">
                        </div>

                        <!-- Скрытое поле для полного кода -->
                        {{ form.code(id="full-code", type="hidden") }}

                        <!-- Ссылка для повторной отправки -->
                        <div class="text-center mb-4">
                            <p class="text-muted mb-2">Не получили код?</p>
                            <a href="{{ url_for('main.resend_verification') }}" 
                               class="btn btn-outline-primary btn-sm"
                               style="border-radius: 12px;">
                                <i class="fas fa-redo me-1"></i>Отправить заново
                            </a>
                        </div>

                        <!-- Кнопка подтверждения -->
                        {{ form.submit(class="btn btn-primary w-100", style="border-radius: 12px; padding: 12px;", value="✓ Подтвердить") }}
                    </form>
                </div>
            </div>

            <!-- Информационная карточка -->
            <div class="card border-0 mt-3" style="background: #1a1a1a; border: 1px solid #3a3a3a;">
                <div class="card-body p-3 text-center">
                    <div class="text-muted small">
                        <i class="fas fa-info-circle me-1"></i>
                        Не можете найти письмо? Проверьте папку "Спам"
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const codeInput = document.getElementById('verification-code');
    const hiddenInput = document.getElementById('full-code');
    
    // Функция для обновления скрытого поля формы
    function updateFormCode() {
        // Убираем все нецифровые символы и ограничиваем длину до 6 символов
        const cleanValue = codeInput.value.replace(/[^0-9]/g, '').slice(0, 6);
        codeInput.value = cleanValue;
        hiddenInput.value = cleanValue;
    }
    
    // Обработчик вставки
    codeInput.addEventListener('paste', function(e) {
        e.preventDefault();
        const pastedData = e.clipboardData.getData('text').replace(/[^0-9]/g, '').slice(0, 6);
        this.value = pastedData;
        updateFormCode();
    });
    
    // Обработчик ввода (для всех событий ввода)
    codeInput.addEventListener('input', updateFormCode);
    codeInput.addEventListener('keyup', updateFormCode);
    codeInput.addEventListener('change', updateFormCode);
    
    // Фокус на поле при загрузке
    codeInput.focus();
});
</script>
{% endblock %} 